<?php	// LOCAL MODE	$localPages = array(		'maps-local',		'maps-upload',		'maps-matchset',		'maps-creatematchset'	);	$data['mapsDirectoryPath'] = AdminServ::getMapsDirectoryPath();	define('IS_LOCAL', file_exists($data['mapsDirectoryPath']));		// LECTURE	if( IS_LOCAL && in_array(USER_PAGE, $localPages) ){		if( !Utils::isWinServer() ){			$checkRightsList[$data['mapsDirectoryPath']] = 755;			$checkRightsList[AdminServConfig::$PATH_RESOURCES . 'cache'] = 777;			AdminServ::checkRights($checkRightsList);		}				// Read current directory		$matchsettingsPages = in_array(USER_PAGE, array('maps-matchset', 'maps-creatematchset'));		$hiddenFolders = ($matchsettingsPages) ? AdminServConfig::$MATCHSET_HIDDEN_FOLDERS : AdminServConfig::$MAPS_HIDDEN_FOLDERS;		$hiddenFiles = ($matchsettingsPages) ? AdminServConfig::$MAP_EXTENSION : AdminServConfig::$MATCHSET_EXTENSION;		$data['currentDir'] = Folder::read($data['mapsDirectoryPath'].$args['directory'], $hiddenFolders, $hiddenFiles, intval(AdminServConfig::RECENT_STATUS_PERIOD * 3600) );	}	else{		$notLocalPages = array(			'maps-local',			'maps-matchset',			'maps-creatematchset'		);		if( in_array(USER_PAGE, $notLocalPages) ){			Utils::redirection(false, '?p=maps-list');		}	}		// ACTIONS	$data['hasDirectory'] = null;	if($args['directory']){		$data['hasDirectory'] = '&d='.$args['directory'];	}		// Nouveau dossier	if( isset($_POST['newFolderValid']) && $_POST['newFolderName'] != null || isset($_POST['newFolderName']) ){		if( Folder::create($data['mapsDirectoryPath'].$args['directory'].Str::replaceChars($_POST['newFolderName'])) !== true ){			AdminServ::error(Utils::t('Unable to create the folder').' : '.$_POST['newFolderName']);		}		else{			AdminServLogs::add('action', 'Create new folder: '.$_POST['newFolderName']);			Utils::redirection(false, '?p='.USER_PAGE .$data['hasDirectory']);		}	}	// Renommer un dossier	else if( isset($_POST['optionFolderHiddenFieldAction']) && $_POST['optionFolderHiddenFieldAction'] == 'rename'){		$newDirectory = addslashes($_POST['optionFolderHiddenFieldValue']);				if( ($result = Folder::rename($data['mapsDirectoryPath'].$args['directory'], $data['mapsDirectoryPath'].$newDirectory)) !== true ){			AdminServ::error(Utils::t('Unable to rename the folder').' : '.$args['directory'].' ('.$result.')');		}		else{			AdminServLogs::add('action', 'Rename folder: '.$args['directory'].' to '.$newDirectory);			Utils::redirection(false, '?p='.USER_PAGE .'&d='.$newDirectory.'/');		}	}	// Déplacer un dossier	else if( isset($_POST['optionFolderHiddenFieldAction']) && $_POST['optionFolderHiddenFieldAction'] == 'move'){		$newPath = addslashes($_POST['optionFolderHiddenFieldValue']);		if($newPath == '.'){			$newPath = $data['mapsDirectoryPath'];		}		$newPath .= basename($args['directory']).'/';		$newPathFromMapsPath = str_replace($data['mapsDirectoryPath'], '', $newPath);		if($newPathFromMapsPath){			$newPathFromMapsPath = '&d='.$newPathFromMapsPath;		}				if( ($result = Folder::rename($data['mapsDirectoryPath'].$args['directory'], $newPath)) !== true ){			AdminServ::error(Utils::t('Unable to move the folder').' : '.$args['directory'].' ('.$result.')');		}		else{			AdminServLogs::add('action', 'Move folder: '.$args['directory'].' to '.$newPathFromMapsPath);			Utils::redirection(false, '?p='.USER_PAGE .$newPathFromMapsPath);		}	}	// Supprimer un dossier	else if( isset($_POST['optionFolderHiddenFieldAction']) && $_POST['optionFolderHiddenFieldAction'] == 'delete'){		if( ($result = Folder::delete($data['mapsDirectoryPath'].$args['directory'])) !== true ){			AdminServ::error(Utils::t('Unable to delete the folder').' : '.$args['directory'].' ('.$result.')');		}		else{			// Clean cache			$cache = new AdminServCache();			$cacheKey = 'mapslist-'.Str::replaceChars($data['mapsDirectoryPath'].$args['directory']);			$cache->delete($cacheKey);						AdminServLogs::add('action', 'Delete folder: '.$args['directory']);			Utils::redirection(false, '?p='.USER_PAGE);		}	}?>